#!/usr/bin/env python3
"""Insert 90 comments for thread No.19: 2åž‹ç³–å°¿ç—…ã®äººã€é›†ã¾ã‚Œã€œ
v2: reply_to kept as original CSV. user_id logic updated so that
when B asks A a question (ï¼Ÿ), C's answer gets A's user_id.
Uses only type2 diabetes users (20 users).
"""

import uuid
import json
import urllib.request
from datetime import datetime, timedelta, timezone

SUPABASE_URL = "https://josanlblwfjdaaezqbnw.supabase.co"
SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impvc2FubGJsd2ZqZGFhZXpxYm53Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2Nzg0MjYwNiwiZXhwIjoyMDgzNDE4NjA2fQ.JlTXBmY5HJAqfRD_AazsiBORpgLZfB74fPkNyyfVSQY"

THREAD_ID = "d2a07aea-fccc-4faa-bfcd-e635a94bafcc"
THREAD_OWNER_ID = "2033ee1c-28b2-5187-8ba1-c94f7964e33e"

# Type2 users only (Ash + 19 batch2 type2 users)
USERS = [
    "b0000001-0000-0000-0000-000000000021",  # ã‚†ã†ã
    "b0000001-0000-0000-0000-000000000023",  # ãã†ãŸ
    "b0000001-0000-0000-0000-000000000025",  # ã‘ã‚“ãŸ
    "b0000001-0000-0000-0000-000000000027",  # ãŸãã‚„
    "b0000001-0000-0000-0000-000000000028",  # ã•ãã‚‰
    "b0000001-0000-0000-0000-000000000029",  # ã“ã†ã¸ã„
    "b0000001-0000-0000-0000-000000000030",  # ãªã¤ã¿
    "f0000001-0000-0000-0000-000000000011",  # ã‚Šã‚‡ã†
    "f0000001-0000-0000-0000-000000000012",  # ã¾ã„ã‹
    "f0000001-0000-0000-0000-000000000015",  # ã ã„ã
    "f0000001-0000-0000-0000-000000000016",  # ã‚ãŠã„
    "f0000001-0000-0000-0000-000000000017",  # ã‚†ã†ãŸ
    "f0000001-0000-0000-0000-000000000019",  # ã‹ã„ã¨
    "f0000001-0000-0000-0000-000000000020",  # ã®ãžã¿
    "f0000001-0000-0000-0000-000000000022",  # ã¡ã¯ã‚‹
    "f0000001-0000-0000-0000-000000000024",  # ã¿ãšã
    "f0000001-0000-0000-0000-000000000025",  # ã—ã‚‡ã†ãŸ
    "f0000001-0000-0000-0000-000000000026",  # ã‚†ã„
    "f0000001-0000-0000-0000-000000000027",  # ã¯ã‚„ã¨
    THREAD_OWNER_ID,  # Ash
]

# reply_to values are original CSV (no modifications)
COMMENTS = [
    (2, None, "2åž‹ã§ã™ï¼å¥åº·è¨ºæ–­ã§ç™ºè¦šã—ã¦3å¹´ç›®ã€‚ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™", "2025-12-16 19:00"),
    (3, None, "ç§ã‚‚2åž‹ã€10å¹´é¸æ‰‹ã§ã™ã€‚é£Ÿäº‹ç™‚æ³•ã¨é£²ã¿è–¬ã§é ‘å¼µã£ã¦ã¾ã™", "2025-12-16 19:45"),
    (4, 2, "ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ï¼ç§ã¯å¥è¨ºã§HbA1c 8.5%å‡ºã¦ç™ºè¦šã—ã¾ã—ãŸ", "2025-12-16 20:30"),
    (5, None, "2åž‹ã£ã¦éºä¼ã‚ã‚Šã¾ã™ã‹ï¼Ÿè¦ªã‚‚ç³–å°¿ç—…ã§â€¦", "2025-12-16 21:15"),
    (6, 5, "éºä¼çš„è¦å› ã¯ã‚ã‚‹ã¿ãŸã„ã§ã™ã­ã€‚ç§ã‚‚çˆ¶ãŒ2åž‹ã§ã™", "2025-12-17 08:30"),
    (7, None, "ãƒ¡ãƒˆãƒ›ãƒ«ãƒŸãƒ³ã¨SGLT2é˜»å®³è–¬é£²ã‚“ã§ã¾ã™ã€‚2åž‹ã®çŽ‹é“ã‹ãª", "2025-12-17 12:00"),
    (8, 5, "ç§ã‚‚æ¯ãŒ2åž‹ã§ã€è‡ªåˆ†ã‚‚40ä»£ã§ç™ºç—‡ã—ã¾ã—ãŸã€‚ã‚„ã£ã±ã‚Šéºä¼ã‚ã‚‹ã¨æ€ã„ã¾ã™", "2025-12-17 14:00"),
    (9, 6, "ãã†ãªã‚“ã§ã™ã­ã€‚æ°—ã‚’ã¤ã‘ã¦ãŸã¤ã‚‚ã‚Šã ã£ãŸã‘ã©â€¦ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™", "2025-12-17 18:00"),
    (10, None, "2åž‹ã ã‘ã©æœ€è¿‘ã‚¤ãƒ³ã‚¹ãƒªãƒ³è¿½åŠ ã«ãªã£ãŸã€‚ã‚·ãƒ§ãƒƒã‚¯ã ã£ãŸãª", "2025-12-17 19:30"),
    (11, 10, "ç§ã‚‚é£²ã¿è–¬ã ã‘ã˜ã‚ƒã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã§ããªãã¦ã‚¤ãƒ³ã‚¹ãƒªãƒ³ä½µç”¨ã«ãªã‚Šã¾ã—ãŸ", "2025-12-17 20:15"),
    (12, None, "ã¿ã‚“ãªè¨ºæ–­ã•ã‚ŒãŸæ™‚ã©ã‚“ãªæ°—æŒã¡ã ã£ãŸï¼Ÿç§ã¯é ­çœŸã£ç™½ã«ãªã£ãŸ", "2025-12-18 10:00"),
    (13, 12, "ç§ã‚‚æœ€åˆã¯å—ã‘å…¥ã‚Œã‚‰ã‚Œãªã‹ã£ãŸã€‚ã€Œãªã‚“ã§è‡ªåˆ†ãŒã€ã£ã¦", "2025-12-18 12:30"),
    (14, 10, "ã‚¤ãƒ³ã‚¹ãƒªãƒ³ä½µç”¨ã€ç§ã‚‚æœ€åˆæŠµæŠ—ã‚ã£ãŸã‘ã©è¡€ç³–å€¤å®‰å®šã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã‚ˆ", "2025-12-18 14:00"),
    (15, 14, "ãã†ãªã‚“ã§ã™ã­ã€‚å°‘ã—å¸Œæœ›æŒã¦ã¾ã—ãŸã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™", "2025-12-18 19:00"),
    (16, 12, "å¥è¨ºã®å†æ¤œæŸ»ã§ç¢ºå®šã—ãŸæ™‚ã€å¸°ã‚Šã®é›»è»Šã§æ³£ã„ãŸ", "2025-12-18 20:30"),
    (17, None, "2åž‹ã§é‹å‹•ç™‚æ³•é ‘å¼µã£ã¦ã‚‹äººã„ã¾ã™ã‹ï¼Ÿä½•ã—ã¦ã¾ã™ï¼Ÿ", "2025-12-19 09:00"),
    (18, 17, "æ¯Žæ—¥30åˆ†ã®ã‚¦ã‚©ãƒ¼ã‚­ãƒ³ã‚°ã—ã¦ã¾ã™ã€‚é£Ÿå¾ŒãŒã„ã„ã£ã¦è¨€ã‚ã‚ŒãŸ", "2025-12-19 10:30"),
    (19, 12, "ç§ã¯é€†ã«ã€Œã‚„ã£ã±ã‚Šãªã€ã£ã¦æ„Ÿã˜ã ã£ãŸã€‚ä¸æ‘‚ç”Ÿã®è‡ªè¦šã‚ã£ãŸã‹ã‚‰â€¦", "2025-12-19 12:00"),
    (20, 17, "é€±3ã§ã‚¸ãƒ é€šã£ã¦ã¾ã™ã€‚ç­‹ãƒˆãƒ¬ã™ã‚‹ã¨è¡€ç³–å€¤ä¸‹ãŒã‚Šã‚„ã™ããªã£ãŸæ°—ãŒã™ã‚‹", "2025-12-19 14:00"),
    (21, 18, "é£Ÿå¾Œã®ã‚¦ã‚©ãƒ¼ã‚­ãƒ³ã‚°ã€ç§ã‚‚ã‚„ã£ã¦ã¿ã¾ã™ï¼ã‚ã‚ŠãŒã¨ã†", "2025-12-19 19:00"),
    (22, None, "GLP-1ä½¿ã£ã¦ã‚‹2åž‹ã®äººã„ã¾ã™ã‹ï¼Ÿä½“é‡ã‚‚æ¸›ã‚‹ã£ã¦èžã„ã¦æ°—ã«ãªã£ã¦ã‚‹", "2025-12-19 20:30"),
    (23, 22, "ãƒªãƒ™ãƒ«ã‚µã‚¹é£²ã‚“ã§ã¾ã™ã€‚ç¢ºã‹ã«é£Ÿæ¬²æ¸›ã£ã¦5kgç—©ã›ãŸ", "2025-12-20 08:00"),
    (24, None, "2åž‹ã®äººã€HbA1cã©ã®ãã‚‰ã„ï¼Ÿç§ã¯7.2%ã§å®‰å®šã—ã¦ããŸ", "2025-12-20 12:00"),
    (25, 24, "6.8%ã§ã™ã€‚ã“ã“ã¾ã§ä¸‹ã’ã‚‹ã®å¤§å¤‰ã ã£ãŸâ€¦", "2025-12-20 14:00"),
    (26, 22, "ã‚ªã‚¼ãƒ³ãƒ”ãƒƒã‚¯æ‰“ã£ã¦ã¾ã™ã€‚åãæ°—ã‚ã£ãŸã‘ã©æ…£ã‚ŒãŸã‚‰å¿«é©", "2025-12-20 15:30"),
    (27, 23, "ãƒªãƒ™ãƒ«ã‚µã‚¹æ°—ã«ãªã‚Šã¾ã™ã€‚å‰¯ä½œç”¨ã©ã†ã§ã™ã‹ï¼Ÿ", "2025-12-20 19:00"),
    (28, 27, "æœ€åˆ1ãƒ¶æœˆã¯åãæ°—ã‚ã£ãŸã‘ã©ä»Šã¯å¤§ä¸ˆå¤«ã§ã™ã‚ˆ", "2025-12-20 20:30"),
    (29, 24, "ç§ã¯7.5%â€¦ã‚‚ã†å°‘ã—ä¸‹ã’ãŸã„ã‘ã©ãªã‹ãªã‹", "2025-12-20 21:00"),
    (30, None, "2åž‹ã§é£Ÿäº‹åˆ¶é™ã—ã¦ã‚‹äººã€ä½•ãŒä¸€ç•ªè¾›ã„ï¼Ÿç§ã¯ç™½ç±³æˆ‘æ…¢ã™ã‚‹ã®ãŒè¾›ã„", "2025-12-21 10:00"),
    (31, 30, "ã‚ã‹ã‚‹ï¼ç™½ç±³å¥½ãã ã‹ã‚‰è¾›ã„ã€‚çŽ„ç±³ã«å¤‰ãˆãŸã‘ã©ç‰©è¶³ã‚Šãªã„", "2025-12-21 11:30"),
    (32, 30, "ç§ã¯ãƒ©ãƒ¼ãƒ¡ãƒ³ã€‚é€±1ã§é£Ÿã¹ã¦ãŸã®ã‚’æœˆ1ã«æ¸›ã‚‰ã—ãŸ", "2025-12-21 14:00"),
    (33, 28, "1ãƒ¶æœˆã‹â€¦ã¡ã‚‡ã£ã¨é•·ã„ã‘ã©è©¦ã—ã¦ã¿ã‚ˆã†ã‹ãªã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™", "2025-12-21 16:00"),
    (34, None, "è·å ´ã§2åž‹ã®ã“ã¨è¨€ã£ã¦ã‚‹äººã„ã¾ã™ã‹ï¼Ÿéš ã—ã¦ã‚‹ã‚“ã ã‘ã©â€¦", "2025-12-21 19:30"),
    (35, 34, "ç§ã¯è¨€ã£ã¦ãªã„ã€‚æ˜¼é£Ÿæ™‚ã«è‰²ã€…è¨€ã‚ã‚Œãã†ã§", "2025-12-21 20:00"),
    (36, 34, "ä¸Šå¸ã«ã ã‘ä¼ãˆã¦ã¾ã™ã€‚ä½•ã‹ã‚ã£ãŸæ™‚ã®ãŸã‚ã«", "2025-12-21 21:00"),
    (37, 30, "ç”˜ã„ã‚‚ã®å…¨èˆ¬ãŒè¾›ã„ã€‚ã‚¹ã‚¤ãƒ¼ãƒ„å¥½ãã ã£ãŸã‹ã‚‰", "2025-12-22 09:00"),
    (38, None, "å¹´æœ«å¹´å§‹ãŒæ€–ã„â€¦æ¯Žå¹´ã“ã®æ™‚æœŸHbA1cä¸ŠãŒã‚‹", "2025-12-22 12:00"),
    (39, 38, "ã‚ã‹ã‚Šã¾ã™ã€‚å®Ÿå®¶å¸°ã‚‹ã¨é£Ÿã¹ã™ãŽã¡ã‚ƒã†", "2025-12-22 14:00"),
    (40, 34, "ç§ã¯ä»²è‰¯ã„åŒåƒšã«ã¯è©±ã—ã¦ã¾ã™ã€‚é£²ã¿ä¼šã®æ™‚ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã‚Œã‚‹", "2025-12-22 15:30"),
    (41, 40, "ãã‚Œã„ã„ã§ã™ã­ã€‚ç§ã‚‚ä¿¡é ¼ã§ãã‚‹äººã«è©±ãã†ã‹ãª", "2025-12-22 19:00"),
    (42, None, "2åž‹ã«ãªã£ã¦é£Ÿç”Ÿæ´»ã©ã®ãã‚‰ã„å¤‰ãˆãŸï¼Ÿ", "2025-12-22 20:30"),
    (43, 42, "ç‚­æ°´åŒ–ç‰©ã‚’åŠåˆ†ã«ã—ãŸã€‚æœ€åˆã‚­ãƒ„ã‹ã£ãŸã‘ã©æ…£ã‚ŒãŸ", "2025-12-23 08:00"),
    (44, 38, "ç§ã¯å¹´æœ«å¹´å§‹ã ã‘è–¬å¢—ã‚„ã—ã¦ã‚‚ã‚‰ã£ã¦ã¾ã™ã€‚å…ˆç”Ÿã¨ç›¸è«‡ã—ã¦", "2025-12-23 10:30"),
    (45, 44, "ãã†ã„ã†æ–¹æ³•ã‚‚ã‚ã‚‹ã‚“ã§ã™ã­ï¼æ¬¡ã®è¨ºå¯Ÿã§èžã„ã¦ã¿ã¾ã™", "2025-12-23 14:00"),
    (46, 42, "é‡Žèœã‹ã‚‰é£Ÿã¹ã‚‹ã‚ˆã†ã«ã—ãŸã€‚é£Ÿã¹é †å¤§äº‹ã£ã¦è¨€ã‚ã‚Œã¦", "2025-12-23 16:00"),
    (47, None, "2åž‹ã§ä½Žè¡€ç³–ãªã‚‹äººã„ã‚‹ï¼ŸSUå‰¤é£²ã‚“ã§ã¦ãŸã¾ã«ãªã‚‹", "2025-12-23 19:00"),
    (48, 47, "ç§ã‚‚ã‚°ãƒªãƒ¡ãƒ”ãƒªãƒ‰ã§ä½Žè¡€ç³–ãªã£ãŸã“ã¨ã‚ã‚‹ã€‚ãƒ–ãƒ‰ã‚¦ç³–æŒã¡æ­©ã„ã¦ã¾ã™", "2025-12-23 20:00"),
    (49, None, "ã‚¯ãƒªã‚¹ãƒžã‚¹ã‚±ãƒ¼ã‚­é£Ÿã¹ã¡ã‚ƒã£ãŸâ€¦åçœ", "2025-12-24 21:00"),
    (50, 49, "ã‚¯ãƒªã‚¹ãƒžã‚¹ãã‚‰ã„ã„ã„ã§ã—ã‚‡ï¼æ˜Žæ—¥ã‹ã‚‰é ‘å¼µã‚ã†", "2025-12-24 21:30"),
    (51, 47, "ç§ã¯DPP-4é˜»å®³è–¬ã«å¤‰ãˆã¦ã‹ã‚‰ä½Žè¡€ç³–ãªããªã‚Šã¾ã—ãŸ", "2025-12-24 22:00"),
    (52, 51, "DPP-4é˜»å®³è–¬ã€ä½Žè¡€ç³–ãƒªã‚¹ã‚¯ä½Žã„ã‚“ã§ã™ã‹ï¼Ÿå…ˆç”Ÿã«ç›¸è«‡ã—ã¦ã¿ã‚ˆã†ã‹ãª", "2025-12-25 10:00"),
    (53, 52, "SUå‰¤ã‚ˆã‚Šä½Žè¡€ç³–èµ·ãã«ãã„ã¿ãŸã„ã§ã™ã‚ˆã€‚ç›¸è«‡ã—ã¦ã¿ã¦ãã ã•ã„", "2025-12-25 12:00"),
    (54, None, "2åž‹è¨ºæ–­ã•ã‚Œã¦ã‹ã‚‰ä½•å¹´ã§è–¬å¢—ãˆãŸï¼Ÿç§ã¯3å¹´ç›®ã§2ç¨®é¡žç›®è¿½åŠ ", "2025-12-25 19:00"),
    (55, 54, "5å¹´ç›®ã§ã‚¤ãƒ³ã‚¹ãƒªãƒ³è¿½åŠ ã«ãªã‚Šã¾ã—ãŸã€‚é€²è¡Œã™ã‚‹ã‚“ã§ã™ã‚ˆã­â€¦", "2025-12-25 20:30"),
    (56, 54, "ç§ã¯2å¹´ç›®ã§3ç¨®é¡žã«ãªã£ãŸã€‚å€‹äººå·®å¤§ãã„ã¿ãŸã„", "2025-12-26 09:00"),
    (57, None, "åˆä½µç—‡æ¤œæŸ»ã¡ã‚ƒã‚“ã¨å—ã‘ã¦ã¾ã™ã‹ï¼Ÿçœ¼åº•æ¤œæŸ»ã¨ã‹", "2025-12-26 14:00"),
    (58, 57, "å¹´1å›žçœ¼ç§‘è¡Œã£ã¦ã¾ã™ã€‚ä»Šã®ã¨ã“ã‚ç•°å¸¸ãªã—ã§ãƒ›ãƒƒã¨ã—ã¦ã‚‹", "2025-12-26 15:30"),
    (59, 57, "è¶³ã®æ¤œæŸ»ã‚‚ã—ãŸæ–¹ãŒã„ã„ã£ã¦è¨€ã‚ã‚ŒãŸã€‚ç¥žçµŒéšœå®³æ€–ã„", "2025-12-26 19:00"),
    (60, None, "æ­£æœˆã€ãŠé¤…é£Ÿã¹ã‚‹ï¼Ÿè¡€ç³–å€¤çˆ†ä¸ŠãŒã‚Šã™ã‚‹ã‹ã‚‰è¿·ã£ã¦ã‚‹", "2025-12-27 12:00"),
    (61, 60, "1å€‹ã ã‘é£Ÿã¹ã‚‹äºˆå®šã€‚æˆ‘æ…¢ã—ã™ãŽã‚‚ã‚¹ãƒˆãƒ¬ã‚¹ã ã‹ã‚‰", "2025-12-27 14:00"),
    (62, 57, "å°¿æ¤œæŸ»ã§è…Žæ©Ÿèƒ½ã‚‚ãƒã‚§ãƒƒã‚¯ã—ã¦ã‚‚ã‚‰ã£ã¦ã¾ã™", "2025-12-27 16:00"),
    (63, 60, "ç§ã¯è«¦ã‚ãŸâ€¦ä»£ã‚ã‚Šã«ä½Žç³–è³ªã®ãŠã›ã¡é£Ÿã¹ã‚‹", "2025-12-27 19:00"),
    (64, None, "2åž‹ã ã‘ã©ãƒªãƒ–ãƒ¬ä½¿ã£ã¦ã‚‹äººã„ã¾ã™ã‹ï¼Ÿè‡ªè²»ã ã‘ã©æ°—ã«ãªã‚‹", "2025-12-28 10:00"),
    (65, 64, "ä½¿ã£ã¦ã¾ã™ï¼é£Ÿäº‹ã®å½±éŸ¿ãŒè¦‹ãˆã¦å‹‰å¼·ã«ãªã‚Šã¾ã™ã‚ˆ", "2025-12-28 12:00"),
    (66, 65, "æœˆã„ãã‚‰ãã‚‰ã„ã‹ã‹ã‚Šã¾ã™ã‹ï¼Ÿ", "2025-12-28 14:30"),
    (67, 66, "ã‚»ãƒ³ã‚µãƒ¼1å€‹ç´„7000å††ã§2é€±é–“ã‚‚ã¤ã‹ã‚‰ã€æœˆ14000å††ãã‚‰ã„ã§ã™ã­", "2025-12-28 16:00"),
    (68, 67, "çµæ§‹ã‹ã‹ã‚Šã¾ã™ã­â€¦ã§ã‚‚ä¾¡å€¤ã‚ã‚‹ãªã‚‰è©¦ã—ã¦ã¿ãŸã„ã‹ã‚‚", "2025-12-28 19:00"),
    (69, None, "å¹´æœ«å¹´å§‹ã®æš´é£²æš´é£Ÿã§è¡€ç³–å€¤ã‚„ã°ã„ã“ã¨ã«ãªã‚Šãã†", "2025-12-29 11:00"),
    (70, 69, "é‹å‹•ã§ç›¸æ®ºã—ã‚ˆã†â€¦ç„¡ç†ã‹ç¬‘", "2025-12-29 12:30"),
    (71, None, "2åž‹ã®å…ˆè¼©æ–¹ã€é•·ãä»˜ãåˆã†ã‚³ãƒ„æ•™ãˆã¦ãã ã•ã„", "2025-12-29 19:00"),
    (72, 71, "å®Œç’§ã‚’ç›®æŒ‡ã•ãªã„ã“ã¨ã€‚8å‰²ã§ãã¦ã‚Œã°OKãã‚‰ã„ã®æ°—æŒã¡ã§", "2025-12-29 20:00"),
    (73, 71, "å®šæœŸçš„ã«é€šé™¢ã‚µãƒœã‚‰ãªã„ã“ã¨ã€‚æ”¾ç½®ãŒä¸€ç•ªãƒ€ãƒ¡", "2025-12-29 21:30"),
    (74, None, "ã‚ã‘ã¾ã—ã¦ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ðŸŽ2åž‹ä»²é–“ã®ã¿ãªã•ã‚“ä»Šå¹´ã‚‚ã‚ˆã‚ã—ã", "2026-01-01 10:00"),
    (75, 74, "ã‚ã‘ãŠã‚ã§ã™ï¼ä»Šå¹´ã“ãHbA1c 6%å°ç›®æŒ‡ã—ã¾ã™", "2026-01-01 11:00"),
    (76, 72, "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚å®Œç’§ä¸»ç¾©ã‚„ã‚ã¦ã‚†ã‚‹ãé ‘å¼µã‚Šã¾ã™", "2026-01-01 14:00"),
    (77, None, "æ­£æœˆ3æ—¥ã§2kgå¤ªã£ãŸâ€¦ã‚„ã£ã±ã‚Šé£Ÿã¹ã™ãŽãŸ", "2026-01-03 18:00"),
    (78, 77, "ç§ã‚‚ï¼ã“ã‚Œã‹ã‚‰å–ã‚Šæˆ»ã•ãªã„ã¨â€¦", "2026-01-03 19:30"),
    (79, None, "2åž‹ã§æœè–¬ãªã—ã§é£Ÿäº‹ã¨é‹å‹•ã ã‘ã§ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã—ã¦ã‚‹äººã„ã¾ã™ã‹ï¼Ÿ", "2026-01-04 12:00"),
    (80, 79, "æœ€åˆã®1å¹´ã¯é£Ÿäº‹ã¨é‹å‹•ã ã‘ã§ã„ã‘ã¦ãŸã€‚ä»Šã¯é£²ã¿è–¬è¿½åŠ ", "2026-01-04 14:00"),
    (81, 79, "HbA1c 6.2%ã§è–¬ãªã—ã§ã™ã€‚ã§ã‚‚ç›¸å½“é ‘å¼µã£ã¦ã‚‹", "2026-01-04 16:30"),
    (82, 81, "ã™ã”ã„ï¼ã©ã‚“ãªé£Ÿäº‹ã—ã¦ã¾ã™ã‹ï¼Ÿ", "2026-01-04 19:00"),
    (83, 82, "ç³–è³ª1é£Ÿ20gä»¥ä¸‹ã«ã—ã¦ã¾ã™ã€‚ã‚ã¨ã¯æ¯Žæ—¥1æ™‚é–“æ­©ã", "2026-01-04 20:30"),
    (84, 83, "ã‚¹ãƒˆã‚¤ãƒƒã‚¯ã§ã™ã­â€¦å‚è€ƒã«ã—ã¾ã™", "2026-01-05 09:00"),
    (85, None, "2åž‹ã®é€šé™¢ã£ã¦æœˆ1ï¼Ÿ2ãƒ¶æœˆã«1å›žï¼Ÿ", "2026-01-05 19:00"),
    (86, 85, "å®‰å®šã—ã¦ã‚‹ã‹ã‚‰2ãƒ¶æœˆã«1å›žã§ã™", "2026-01-05 20:00"),
    (87, 85, "ç§ã¯æœˆ1ã€‚è–¬ã®å‡¦æ–¹ã‚‚ã‚ã‚‹ã‹ã‚‰", "2026-01-05 21:00"),
    (88, None, "ã“ã®ã‚¹ãƒ¬ã‚ã‚‹ã¨2åž‹ä»²é–“ãŒã„ã‚‹ã£ã¦å®Ÿæ„Ÿã§ãã¦å¬‰ã—ã„", "2026-01-06 19:00"),
    (89, 88, "åŒã˜ç—…æ°—ã®äººã¨è©±ã›ã‚‹ã®ã‚ã‚ŠãŒãŸã„ã§ã™ã‚ˆã­", "2026-01-06 20:00"),
    (90, None, "ãƒªã‚¢ãƒ«ã˜ã‚ƒãªã‹ãªã‹è©±ã›ãªã„ã‹ã‚‰ã“ã“ã§åãå‡ºã—ã¦ã‚‹", "2026-01-07 19:30"),
    (91, 90, "ã‚ã‹ã‚‹ã€‚è·å ´ã‚„å®¶æ—ã«è¨€ãˆãªã„ã“ã¨ã‚‚ã‚ã‚‹ã‚‚ã‚“ã­", "2026-01-07 20:30"),
]


def jst_to_utc(jst_str):
    dt = datetime.strptime(jst_str, "%Y-%m-%d %H:%M")
    dt_utc = dt - timedelta(hours=9)
    return dt_utc.strftime("%Y-%m-%dT%H:%M:%S+00:00")


def assign_user_ids(comments):
    """Assign user_ids with question-answer awareness.
    When B asks A a question (reply contains ï¼Ÿ) and C replies to B,
    C gets A's user_id (the person who was asked answers).
    """
    user_map = {}
    body_map = {}
    reply_map = {}
    for num, reply_to, body, dt in comments:
        body_map[num] = body
        reply_map[num] = reply_to

    user_idx = 0
    for num, reply_to, body, dt in comments:
        # Check Aâ†’B(question)â†’C(answer) pattern
        if reply_to and reply_to in reply_map:
            B_num = reply_to
            A_num = reply_map[B_num]
            B_body = body_map.get(B_num, "")
            if A_num and "ï¼Ÿ" in B_body and A_num in user_map:
                user_map[num] = user_map[A_num]
                continue

        # Normal assignment: ensure different from parent
        if reply_to and reply_to in user_map:
            parent_user = user_map[reply_to]
            candidate = USERS[user_idx % len(USERS)]
            while candidate == parent_user:
                user_idx += 1
                candidate = USERS[user_idx % len(USERS)]
            user_map[num] = candidate
            user_idx += 1
        else:
            user_map[num] = USERS[user_idx % len(USERS)]
            user_idx += 1

    return user_map


def insert_batch(records, batch_num):
    url = f"{SUPABASE_URL}/rest/v1/comments"
    headers = {
        "apikey": SUPABASE_KEY,
        "Authorization": f"Bearer {SUPABASE_KEY}",
        "Content-Type": "application/json",
        "Prefer": "return=minimal",
    }
    data = json.dumps(records).encode("utf-8")
    req = urllib.request.Request(url, data=data, headers=headers, method="POST")
    try:
        with urllib.request.urlopen(req) as resp:
            print(f"  Batch {batch_num}: {resp.status} - {len(records)} records inserted")
            return True
    except urllib.error.HTTPError as e:
        print(f"  Batch {batch_num}: ERROR {e.code} - {e.read().decode()}")
        return False


def main():
    print(f"Processing {len(COMMENTS)} comments for thread No.19 (v2 - fixed)")
    print(f"Thread ID: {THREAD_ID}")
    print(f"Users pool: {len(USERS)} type2 users")

    comment_uuids = {}
    for num, _, _, _ in COMMENTS:
        comment_uuids[num] = str(uuid.uuid4())

    user_map = assign_user_ids(COMMENTS)

    records = []
    now_utc = datetime.now(timezone.utc)
    past_count = 0
    future_count = 0

    for num, reply_to, body, dt_jst in COMMENTS:
        utc_str = jst_to_utc(dt_jst)
        dt_obj = datetime.strptime(dt_jst, "%Y-%m-%d %H:%M").replace(tzinfo=timezone(timedelta(hours=9)))
        if dt_obj > now_utc:
            future_count += 1
        else:
            past_count += 1

        parent_id = comment_uuids[reply_to] if reply_to else None
        record = {
            "id": comment_uuids[num],
            "thread_id": THREAD_ID,
            "body": body,
            "user_id": user_map[num],
            "is_hidden": False,
            "created_at": utc_str,
            "parent_id": parent_id,
        }
        records.append(record)

    print(f"Past comments: {past_count}")
    print(f"Future comments: {future_count}")
    print(f"Total: {len(records)}")
    print()

    BATCH_SIZE = 50
    for i in range(0, len(records), BATCH_SIZE):
        batch = records[i:i+BATCH_SIZE]
        batch_num = i // BATCH_SIZE + 1
        if not insert_batch(batch, batch_num):
            print("STOPPING due to error")
            return

    print(f"\nAll {len(records)} comments inserted!")

    print(f"\nUpdating comments_count to {past_count}...")
    url = f"{SUPABASE_URL}/rest/v1/threads?id=eq.{THREAD_ID}"
    headers = {
        "apikey": SUPABASE_KEY,
        "Authorization": f"Bearer {SUPABASE_KEY}",
        "Content-Type": "application/json",
        "Prefer": "return=minimal",
    }
    data = json.dumps({"comments_count": past_count}).encode("utf-8")
    req = urllib.request.Request(url, data=data, headers=headers, method="PATCH")
    try:
        with urllib.request.urlopen(req) as resp:
            print(f"  Updated: {resp.status}")
    except urllib.error.HTTPError as e:
        print(f"  ERROR: {e.code} - {e.read().decode()}")


if __name__ == "__main__":
    main()
